import {useEffect, useState} from 'react'
import style from './Card.module.css'
import {NavLink} from 'react-router-dom'
import {createClient} from "@supabase/supabase-js";

export const Card = ({id, username, likes, idUser, avatar, img}) => {
    const supabase = createClient('https://ndnfqgznxmxuserdlhhl.supabase.co', "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5kbmZxZ3pueG14dXNlcmRsaGhsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MDA0MDQwNjUsImV4cCI6MjAxNTk4MDA2NX0.XBHCk_KnwRYLHRGt3jqjdVrls5Y6x3Z-nX9YL4zIaAs");

    const [count, setCount] = useState(0);
    const projectPage =
        {
            src: '/ProjectPage',
        }

    const userId = localStorage.getItem("id");

    const onLiked = async () => {
        try {
            if (!userId) {
                return location.href = `${location.origin}/LogIn`;
            }

            if (localStorage.getItem(`${id}-work-liked`)) {
                const {data} = await supabase
                    .from('liked_works')
                    .delete()
                    .eq('user_id', userId)
                    .eq('work_id', id);

                const {data: data1} = await supabase
                    .from("works")
                    .update({"count": likes - 1})
                    .eq('id', id);

                setCount(prev => prev - 1);
                return localStorage.removeItem(`${id}-work-liked`);
            }

            const {data: data2} = await supabase
                .from('liked_works')
                .insert({
                    "work_id": id,
                    "user_id": userId
                });

            const {data: data3} = await supabase
                .from("works")
                .update({"count": likes + 1})
                .eq('id', id);

            setCount(prev => prev + 1);
            localStorage.setItem(`${id}-work-liked`, "true");
        } catch (e) {
            console.log(e);
        }
    };

    useEffect(() => {
        setCount(likes);
    }, [likes]);

    return (
        <div className={style.card}>

            <NavLink to={`${projectPage.src}/${id}`} className={style.form__home}>
                <img className={style.card__image} src={img} alt=""/>
            </NavLink>

            <div className={style.card__content}>
                <div className={style.content__author}>
                    <img className={style.author__image} src={avatar} alt=""/>
                    <h1 className={style.author__name}>
                        <NavLink to={`${location.origin}/AccountPage/${idUser}`}>
                            {username}
                        </NavLink>
                    </h1>
                </div>
                <div className={style.content__likes}>
                    <div className={style.likes__count}>
                        {count || 0}
                    </div>
                    <button className={style.likes__button} onClick={() => onLiked(id)}>
                    {localStorage.getItem(`${id}-work-liked`) ? <svg width="19" height="18" viewBox="0 0 19 18" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M3.60131 3.87853C3.07439 4.56648 2.77954 5.53645 2.77954 6.57588C2.77954 7.61898 3.18986 8.68396 3.88307 9.73172C4.57462 10.777 5.51304 11.752 6.47915 12.5961C7.44186 13.4372 8.4088 14.1283 9.13715 14.6098C9.43906 14.8094 9.69848 14.972 9.89768 15.0934C10.0969 14.972 10.3563 14.8094 10.6582 14.6098C11.3866 14.1283 12.3535 13.4372 13.3162 12.5961C14.2823 11.752 15.2207 10.777 15.9123 9.73172C16.6055 8.68396 17.0158 7.61898 17.0158 6.57588C17.0158 5.53486 16.7229 4.56503 16.1977 3.87782C15.6917 3.21583 14.9478 2.77954 13.9016 2.77954C12.831 2.77954 12.0247 3.22187 11.4683 3.68552C11.1896 3.91778 10.9804 4.15039 10.8427 4.32246C10.7743 4.40801 10.7247 4.47716 10.6941 4.5218C10.6788 4.54407 10.6683 4.5601 10.6628 4.56884C10.6608 4.57197 10.6586 4.57535 10.6586 4.57535L9.90085 5.83832L9.13839 4.57806C9.13839 4.57806 9.13621 4.57461 9.13414 4.5714C9.12845 4.56258 9.11787 4.54647 9.10244 4.52411C9.0715 4.4793 9.02144 4.40996 8.95249 4.32422C8.81381 4.15177 8.60335 3.91874 8.32361 3.6861C7.76473 3.22134 6.95814 2.77954 5.89373 2.77954C4.85403 2.77954 4.10941 3.21515 3.60131 3.87853ZM9.89768 16.1261C9.466 16.9041 9.46554 16.9038 9.46554 16.9038L9.46306 16.9025C9.46306 16.9025 9.45963 16.9005 9.4572 16.8992C9.45234 16.8965 9.44557 16.8927 9.43695 16.8878C9.41972 16.8781 9.39511 16.8641 9.3636 16.8459C9.30058 16.8096 9.20993 16.7567 9.0956 16.688C8.86702 16.5508 8.54318 16.3504 8.15574 16.0943C7.38261 15.5831 6.34757 14.8442 5.3083 13.9362C4.27243 13.0312 3.20887 11.9378 2.39894 10.7136C1.59067 9.49194 1 8.08636 1 6.57588C1 5.22777 1.37804 3.85468 2.18855 2.79646C3.01788 1.71367 4.27524 1 5.89373 1C7.48749 1 8.68289 1.67041 9.46144 2.31786C9.623 2.45221 9.76785 2.5865 9.8961 2.71512C10.0238 2.58666 10.1681 2.45258 10.3291 2.31844C11.1073 1.66988 12.3029 1 13.9016 1C15.5248 1 16.7829 1.71299 17.6115 2.79717C18.4209 3.85613 18.7954 5.22936 18.7954 6.57588C18.7954 8.08636 18.2047 9.49194 17.3964 10.7136C16.5865 11.9378 15.5229 13.0312 14.4871 13.9362C13.4478 14.8442 12.4128 15.5831 11.6396 16.0943C11.2522 16.3504 10.9283 16.5508 10.6998 16.688C10.5854 16.7567 10.4948 16.8096 10.4318 16.8459C10.4003 16.8641 10.3756 16.8781 10.3584 16.8878C10.3543 16.8901 10.3507 16.8922 10.3475 16.894C10.3438 16.896 10.3407 16.8978 10.3382 16.8992C10.3357 16.9005 10.3323 16.9025 10.3323 16.9025L10.3298 16.9038C10.3298 16.9038 10.3294 16.9041 9.89768 16.1261ZM9.89768 16.1261L10.3298 16.9038L9.89768 17.1436L9.46554 16.9038L9.89768 16.1261Z" fill="black"/>
                        <path d="M2.77954 6.57588C2.77954 5.53645 3.07439 4.56648 3.60131 3.87853C4.10941 3.21515 4.85403 2.77954 5.89373 2.77954C6.95814 2.77954 7.76473 3.22134 8.32361 3.6861C8.60335 3.91874 8.81381 4.15177 8.95249 4.32422C9.02144 4.40996 9.0715 4.4793 9.10244 4.52411C9.11787 4.54647 9.12845 4.56258 9.13414 4.5714L9.13839 4.57806L9.90085 5.83832L10.6586 4.57535L10.6628 4.56884C10.6683 4.5601 10.6788 4.54407 10.6941 4.5218C10.7247 4.47716 10.7743 4.40801 10.8427 4.32246C10.9804 4.15039 11.1896 3.91778 11.4683 3.68552C12.0247 3.22187 12.831 2.77954 13.9016 2.77954C14.9478 2.77954 15.6917 3.21583 16.1977 3.87782C16.7229 4.56503 17.0158 5.53486 17.0158 6.57588C17.0158 7.61898 16.6055 8.68396 15.9123 9.73172C15.2207 10.777 14.2823 11.752 13.3162 12.5961C12.3535 13.4372 11.3866 14.1283 10.6582 14.6098C10.3563 14.8094 10.0969 14.972 9.89768 15.0934C9.69848 14.972 9.43906 14.8094 9.13715 14.6098C8.4088 14.1283 7.44186 13.4372 6.47915 12.5961C5.51304 11.752 4.57462 10.777 3.88307 9.73172C3.18986 8.68396 2.77954 7.61898 2.77954 6.57588Z" fill="black"/>
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M2.70385 2.87853C2.17693 3.56648 1.88208 4.53645 1.88208 5.57588C1.88208 6.61898 2.2924 7.68396 2.9856 8.73172C3.67716 9.77699 4.61558 10.752 5.58169 11.5961C6.5444 12.4372 7.51134 13.1283 8.23969 13.6098C8.5416 13.8094 8.80102 13.972 9.00022 14.0934C9.19943 13.972 9.45885 13.8094 9.76076 13.6098C10.4891 13.1283 11.456 12.4372 12.4188 11.5961C13.3849 10.752 14.3233 9.77699 15.0148 8.73172C15.708 7.68396 16.1184 6.61898 16.1184 5.57588C16.1184 4.53486 15.8255 3.56503 15.3002 2.87782C14.7943 2.21583 14.0503 1.77954 13.0042 1.77954C11.9336 1.77954 11.1272 2.22187 10.5708 2.68552C10.2921 2.91778 10.0829 3.15039 9.94526 3.32246C9.87682 3.40801 9.82721 3.47716 9.7966 3.5218C9.78133 3.54407 9.77088 3.5601 9.76529 3.56884C9.76329 3.57197 9.76116 3.57535 9.76116 3.57535L9.00338 4.83832L8.24093 3.57806C8.24093 3.57806 8.23875 3.57461 8.23668 3.5714C8.23099 3.56258 8.22041 3.54647 8.20498 3.52411C8.17404 3.4793 8.12398 3.40996 8.05503 3.32422C7.91635 3.15177 7.70589 2.91874 7.42615 2.6861C6.86727 2.22134 6.06068 1.77954 4.99626 1.77954C3.95657 1.77954 3.21194 2.21515 2.70385 2.87853ZM9.00022 15.1261C8.56854 15.9041 8.56808 15.9038 8.56808 15.9038L8.56559 15.9025C8.56559 15.9025 8.56217 15.9005 8.55974 15.8992C8.55488 15.8965 8.54811 15.8927 8.53949 15.8878C8.52226 15.8781 8.49765 15.8641 8.46614 15.8459C8.40312 15.8096 8.31247 15.7567 8.19813 15.688C7.96956 15.5508 7.64572 15.3504 7.25828 15.0943C6.48515 14.5831 5.45011 13.8442 4.41084 12.9362C3.37497 12.0312 2.31141 10.9378 1.50148 9.71363C0.693209 8.49194 0.102539 7.08636 0.102539 5.57588C0.102539 4.22777 0.480576 2.85468 1.29109 1.79646C2.12042 0.713672 3.37777 0 4.99626 0C6.59003 0 7.78542 0.670411 8.56398 1.31786C8.72554 1.45221 8.87039 1.5865 8.99864 1.71512C9.12636 1.58666 9.27063 1.45258 9.4316 1.31844C10.2099 0.669879 11.4055 0 13.0042 0C14.6273 0 15.8854 0.712986 16.7141 1.79717C17.5235 2.85613 17.8979 4.22936 17.8979 5.57588C17.8979 7.08636 17.3072 8.49194 16.499 9.71363C15.689 10.9378 14.6255 12.0312 13.5896 12.9362C12.5503 13.8442 11.5153 14.5831 10.7422 15.0943C10.3547 15.3504 10.0309 15.5508 9.80231 15.688C9.68797 15.7567 9.59733 15.8096 9.53431 15.8459C9.5028 15.8641 9.47818 15.8781 9.46095 15.8878C9.45689 15.8901 9.45323 15.8922 9.44999 15.894C9.44637 15.896 9.44327 15.8978 9.44071 15.8992C9.43828 15.9005 9.43485 15.9025 9.43485 15.9025L9.43236 15.9038C9.43236 15.9038 9.4319 15.9041 9.00022 15.1261ZM9.00022 15.1261L9.43236 15.9038L9.00022 16.1436L8.56808 15.9038L9.00022 15.1261Z" fill="black"/>
                        <path d="M1.88208 5.57588C1.88208 4.53645 2.17693 3.56648 2.70385 2.87853C3.21194 2.21515 3.95657 1.77954 4.99626 1.77954C6.06068 1.77954 6.86727 2.22134 7.42615 2.6861C7.70589 2.91874 7.91635 3.15177 8.05503 3.32422C8.12398 3.40996 8.17404 3.4793 8.20498 3.52411C8.22041 3.54647 8.23099 3.56258 8.23668 3.5714L8.24093 3.57806L9.00338 4.83832L9.76116 3.57535L9.76529 3.56884C9.77088 3.5601 9.78133 3.54407 9.7966 3.5218C9.82721 3.47716 9.87682 3.40801 9.94526 3.32246C10.0829 3.15039 10.2921 2.91778 10.5708 2.68552C11.1272 2.22187 11.9336 1.77954 13.0042 1.77954C14.0503 1.77954 14.7943 2.21583 15.3002 2.87782C15.8255 3.56503 16.1184 4.53486 16.1184 5.57588C16.1184 6.61898 15.708 7.68396 15.0148 8.73172C14.3233 9.77699 13.3849 10.752 12.4188 11.5961C11.456 12.4372 10.4891 13.1283 9.76076 13.6098C9.45885 13.8094 9.19943 13.972 9.00022 14.0934C8.80102 13.972 8.5416 13.8094 8.23969 13.6098C7.51134 13.1283 6.5444 12.4372 5.58169 11.5961C4.61558 10.752 3.67716 9.77699 2.9856 8.73172C2.2924 7.68396 1.88208 6.61898 1.88208 5.57588Z" fill="#F94A29"/>
                        </svg> : <svg xmlns="http://www.w3.org/2000/svg" width="19" height="18" viewBox="0 0 14 12" fill="none">
                            <path fillRule="evenodd" clipRule="evenodd"
                                  d="M2.65357 2.20008C2.26531 2.70774 2.04805 3.42351 2.04805 4.19054C2.04805 4.96027 2.35039 5.74615 2.86118 6.51933C3.37074 7.29066 4.06221 8.01015 4.77408 8.63304C5.48345 9.25373 6.19593 9.76368 6.73261 10.119C6.95506 10.2663 7.14622 10.3863 7.293 10.4759C7.43978 10.3863 7.63093 10.2663 7.85339 10.119C8.39007 9.76368 9.10255 9.25373 9.81192 8.63304C10.5238 8.01015 11.2153 7.29066 11.7248 6.51933C12.2356 5.74615 12.5379 4.96027 12.5379 4.19054C12.5379 3.42234 12.3221 2.70667 11.9351 2.19956C11.5623 1.71106 11.0141 1.3891 10.2433 1.3891C9.45441 1.3891 8.86025 1.71551 8.45029 2.05765C8.24492 2.22904 8.09077 2.4007 7.98934 2.52767C7.93891 2.5908 7.90236 2.64183 7.87981 2.67477C7.86855 2.6912 7.86086 2.70303 7.85673 2.70948C7.85526 2.71179 7.85369 2.71429 7.85369 2.71429L7.29533 3.64627L6.73352 2.71629C6.73352 2.71629 6.73191 2.71374 6.73039 2.71137C6.7262 2.70486 6.7184 2.69297 6.70703 2.67647C6.68423 2.6434 6.64735 2.59224 6.59654 2.52897C6.49436 2.40171 6.33928 2.22975 6.13315 2.05808C5.72135 1.71512 5.12702 1.3891 4.34272 1.3891C3.57663 1.3891 3.02796 1.71055 2.65357 2.20008ZM7.293 11.2379C6.97492 11.812 6.97458 11.8118 6.97458 11.8118L6.97275 11.8108C6.97275 11.8108 6.97022 11.8094 6.96843 11.8084C6.96485 11.8064 6.95986 11.8036 6.95352 11.8C6.94082 11.7928 6.92268 11.7825 6.89946 11.7691C6.85303 11.7423 6.78624 11.7032 6.70199 11.6526C6.53357 11.5513 6.29495 11.4035 6.00947 11.2144C5.43979 10.8373 4.67713 10.292 3.91135 9.62193C3.14808 8.95407 2.36441 8.14727 1.76762 7.2439C1.17205 6.34238 0.736816 5.30516 0.736816 4.19054C0.736816 3.19572 1.01537 2.18248 1.61259 1.40159C2.22368 0.602567 3.15015 0.0759277 4.34272 0.0759277C5.51707 0.0759277 6.39789 0.570644 6.97156 1.04841C7.0906 1.14756 7.19734 1.24665 7.29183 1.34157C7.38594 1.24677 7.49225 1.14783 7.61085 1.04884C8.18432 0.570251 9.0653 0.0759277 10.2433 0.0759277C11.4393 0.0759277 12.3663 0.602061 12.9769 1.40212C13.5733 2.18355 13.8492 3.1969 13.8492 4.19054C13.8492 5.30516 13.414 6.34238 12.8184 7.2439C12.2216 8.14727 11.4379 8.95407 10.6746 9.62193C9.90887 10.292 9.14621 10.8373 8.57653 11.2144C8.29105 11.4035 8.05243 11.5513 7.88401 11.6526C7.79976 11.7032 7.73297 11.7423 7.68654 11.7691C7.66332 11.7825 7.64518 11.7928 7.63248 11.8C7.62949 11.8017 7.62679 11.8032 7.62441 11.8046C7.62174 11.8061 7.61946 11.8074 7.61757 11.8084C7.61578 11.8094 7.61325 11.8108 7.61325 11.8108L7.61142 11.8118C7.61142 11.8118 7.61108 11.812 7.293 11.2379ZM7.293 11.2379L7.61142 11.8118L7.293 11.9888L6.97458 11.8118L7.293 11.2379Z"
                                  fill="black"/>
                            <path
                                d="M2.04805 4.19054C2.04805 3.42351 2.26531 2.70774 2.65357 2.20008C3.02796 1.71055 3.57663 1.3891 4.34272 1.3891C5.12702 1.3891 5.72135 1.71512 6.13315 2.05808C6.33928 2.22975 6.49436 2.40171 6.59654 2.52897C6.64735 2.59224 6.68423 2.6434 6.70703 2.67647C6.7184 2.69297 6.7262 2.70486 6.73039 2.71137L6.73352 2.71629L7.29533 3.64627L7.85369 2.71429L7.85673 2.70948C7.86086 2.70303 7.86855 2.6912 7.87981 2.67477C7.90236 2.64183 7.93891 2.5908 7.98934 2.52767C8.09077 2.4007 8.24492 2.22904 8.45029 2.05765C8.86025 1.71551 9.45441 1.3891 10.2433 1.3891C11.0141 1.3891 11.5623 1.71106 11.9351 2.19956C12.3221 2.70667 12.5379 3.42234 12.5379 4.19054C12.5379 4.96027 12.2356 5.74615 11.7248 6.51933C11.2153 7.29066 10.5238 8.01015 9.81192 8.63304C9.10255 9.25373 8.39007 9.76368 7.85339 10.119C7.63093 10.2663 7.43978 10.3863 7.293 10.4759C7.14622 10.3863 6.95506 10.2663 6.73261 10.119C6.19593 9.76368 5.48345 9.25373 4.77408 8.63304C4.06221 8.01015 3.37074 7.29066 2.86118 6.51933C2.35039 5.74615 2.04805 4.96027 2.04805 4.19054Z"
                                fill="black"/>
                        </svg>}
                    </button>
                </div>
            </div>
        </div>
    )
}
